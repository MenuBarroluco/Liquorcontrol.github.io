<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Bar Control - Análisis de Ventas</title>
    
    <!-- 1. Estilos (Tailwind) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React y ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Fondo oscuro general */
        body { background-color: #0f172a; color: #e2e8f0; font-family: sans-serif; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body>
    <div id="root">Cargando aplicación...</div>

    <script type="text/babel">
        class ErrorBoundary extends React.Component {
            constructor(props) { super(props); this.state = { hasError: false }; }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            render() {
                if (this.state.hasError) return <div className="p-10 text-center text-red-400">Algo salió mal. Recarga la página.</div>;
                return this.props.children;
            }
        }

        const { useState, useEffect, useMemo } = React;

        // --- ICONOS ---
        const IconWrapper = ({ children, className, size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Icons = {
            Beer: (p) => <IconWrapper {...p}><path d="M17 11h1a3 3 0 0 1 0 6h-1"/><path d="M9 12h6"/><path d="M9 12v3a8 8 0 0 1-16 0v-3"/><path d="M22 6h-7a2 2 0 0 0-2 2v2"/><path d="M5 12V3a2 2 0 0 1 2-2h7"/></IconWrapper>,
            Wine: (p) => <IconWrapper {...p}><path d="M8 22h8"/><path d="M7 10h10"/><path d="M12 15v7"/><path d="M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z"/></IconWrapper>,
            GlassWater: (p) => <IconWrapper {...p}><path d="M15.2 22H8.8a2 2 0 0 1-2-1.79L5 3h14l-1.81 17.21A2 2 0 0 1 15.2 22Z"/><path d="M6 12a5 5 0 0 1 6 0 5 5 0 0 0 6 0"/></IconWrapper>,
            Package: (p) => <IconWrapper {...p}><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-9"/></IconWrapper>,
            Search: (p) => <IconWrapper {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconWrapper>,
            Download: (p) => <IconWrapper {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></IconWrapper>,
            ChevronDown: (p) => <IconWrapper {...p}><path d="m6 9 6 6 6-6"/></IconWrapper>,
            ChevronUp: (p) => <IconWrapper {...p}><path d="m18 15-6-6-6 6"/></IconWrapper>,
            AlertTriangle: (p) => <IconWrapper {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></IconWrapper>,
            CheckCircle: (p) => <IconWrapper {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="M22 4 12 14.01l-3-3"/></IconWrapper>,
            RotateCcw: (p) => <IconWrapper {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconWrapper>,
            Calculator: (p) => <IconWrapper {...p}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></IconWrapper>,
            MapPin: (p) => <IconWrapper {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconWrapper>,
            DollarSign: (p) => <IconWrapper {...p}><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></IconWrapper>,
            ShoppingCart: (p) => <IconWrapper {...p}><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></IconWrapper>,
            RefreshCw: (p) => <IconWrapper {...p}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconWrapper>
        };

        // --- DATOS INICIALES ---
        const createItem = (id, name, startStock = 0) => ({
            id, name,
            bar1: "", bar2: "", bodega: "", barroluco: "",
            start: startStock, purchases: "", sales: "", toastSales: ""
        });

        const INITIAL_DATA = [
            {
                category: "Licores Premium (Tequila/Whisky)",
                items: [
                    createItem("liq-1", "Casamigos Blanco", 22),
                    createItem("liq-2", "Casamigos Reposado", 22),
                    createItem("liq-3", "Don Julio Blanco", 65),
                    createItem("liq-4", "Don Julio Reposado", 19),
                    createItem("liq-5", "Don Julio Cristalino", 0),
                    createItem("liq-6", "Patron Silver", 0),
                    createItem("liq-7", "Patron Reposado", 0),
                    createItem("liq-8", "Clase Azul", 0),
                    createItem("liq-9", "Grand Old Parr 12", 22),
                    createItem("liq-10", "Crown Royal Regal Apple", 24),
                    createItem("liq-11", "Crown Royal", 31),
                    createItem("liq-12", "Buchanans 12", 23),
                    createItem("liq-13", "Johnnie Walker Black", 24),
                    createItem("liq-14", "Captain Morgan Spiced", 44),
                    createItem("liq-15", "Brugal Añejo", 0),
                    createItem("liq-16", "Grey Goose", 0),
                    createItem("liq-17", "Jack Daniels Black", 57),
                    createItem("liq-18", "Woodford Reserve", 21),
                    createItem("liq-19", "Fernet Branca", 0),
                    createItem("liq-20", "Disaronno Amaretto", 0),
                    createItem("liq-21", "Remy Martin", 0),
                    createItem("liq-22", "Novo Fogo Silver Cachaça", 0),
                ]
            },
            {
                category: "Wells (Licores de la Casa)",
                items: [
                    createItem("wel-1", "Bacardi Light", 0),
                    createItem("wel-2", "Bacardi Lime", 0),
                    createItem("wel-3", "Pirassununga Cachaça 51", 24),
                    createItem("wel-4", "Barton Naturals Vodka", 0),
                    createItem("wel-5", "Peach Schnapps Boston", 0),
                    createItem("wel-6", "Montezuma White", 0),
                    createItem("wel-7", "Triple Sec Boston", 31),
                    createItem("wel-8", "Long Island Tea Mix", 0),
                    createItem("wel-9", "Curacao Blue", 0),
                    createItem("wel-10", "Melon Boston", 0),
                    createItem("wel-11", "Sour Apple HW", 0),
                    createItem("wel-12", "Sour Cherry Boston", 0),
                ]
            },
            {
                category: "Seltzer & Energy",
                items: [
                    createItem("sel-1", "Red Bull Sugar Free", 0),
                    createItem("sel-2", "Red Bull Regular", 0),
                    createItem("sel-3", "Red Bull Watermelon", 0),
                    createItem("sel-4", "Red Bull Juneberry", 0),
                    createItem("sel-5", "High Noon Variety Pack", 0),
                ]
            },
            {
                category: "Cervezas",
                items: [
                    createItem("cer-1", "Pacifico", 0),
                    createItem("cer-2", "Michelob Ultra", 0),
                    createItem("cer-3", "Modelo Especial", 0),
                    createItem("cer-4", "Heineken", 0),
                ]
            },
            {
                category: "Vinos",
                items: [
                    createItem("vin-1", "Sangria", 0),
                    createItem("vin-2", "Chardonnay El Enemigo", 0),
                    createItem("vin-3", "Prosecco Zonin", 0),
                    createItem("vin-4", "Imperial Nectar Rose", 0),
                ]
            }
        ];

        // --- COMPONENTES ---

        const Header = ({ onReset, onDownload }) => (
            <header className="bg-black/90 border-b border-gray-800 text-white p-4 sticky top-0 z-30 shadow-2xl backdrop-blur-md">
                <div className="max-w-5xl mx-auto flex justify-between items-center">
                    <div className="flex items-center gap-3">
                        <div className="bg-amber-500/10 border border-amber-500/20 p-2 rounded-xl text-amber-500">
                            <Icons.Beer size={24} />
                        </div>
                        <div>
                            <h1 className="font-bold text-lg leading-tight text-gray-100">Master Bar Control</h1>
                            <p className="text-xs text-gray-400">Análisis de Ventas</p>
                        </div>
                    </div>
                    <div className="flex gap-2">
                        <button onClick={onReset} className="p-2 bg-gray-800 hover:bg-gray-700 text-gray-400 hover:text-white rounded-full transition-all border border-gray-700" title="Reiniciar">
                            <Icons.RotateCcw size={18} />
                        </button>
                        <button onClick={onDownload} className="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded-lg font-medium transition-all shadow-lg shadow-emerald-900/20 active:scale-95 text-sm">
                            <Icons.Download size={18} />
                            <span className="hidden sm:inline">Descargar Excel</span>
                        </button>
                    </div>
                </div>
            </header>
        );

        const CategoryHeader = ({ title, icon: Icon, isOpen, toggle }) => (
            <button onClick={toggle} className="w-full flex items-center justify-between p-4 bg-gray-800/80 border border-gray-700/50 hover:bg-gray-800 rounded-xl shadow-lg mb-2 transition-all sticky top-[76px] lg:top-[88px] z-20 backdrop-blur-sm group">
                <div className="flex items-center gap-3">
                    <div className="text-amber-500 group-hover:text-amber-400 transition-colors">
                        <Icon size={20} />
                    </div>
                    <h2 className="font-bold text-gray-200 text-lg group-hover:text-white transition-colors">{title}</h2>
                </div>
                {isOpen ? <Icons.ChevronUp className="text-gray-500" /> : <Icons.ChevronDown className="text-gray-500" />}
            </button>
        );

        const InputField = ({ label, value, onChange, colorClass = "border-gray-700", icon: Icon }) => (
            <div className="relative group">
                <label className="block text-[10px] text-gray-500 font-bold uppercase mb-1 flex items-center gap-1 group-hover:text-gray-400 transition-colors">
                    {Icon && <Icon size={10} />} {label}
                </label>
                <input 
                    type="number" step="0.1" placeholder="-" value={value}
                    onChange={(e) => onChange(e.target.value)}
                    className={`w-full bg-gray-900/50 border rounded-lg px-3 py-2 font-mono text-sm focus:outline-none focus:ring-1 focus:ring-amber-500/50 focus:border-amber-500 transition-all ${colorClass} ${value !== "" && value !== 0 ? 'text-amber-400 font-bold bg-gray-900 border-amber-900/30' : 'text-gray-500'}`}
                />
            </div>
        );

        const InventoryRow = ({ item, onUpdate }) => {
            const [isExpanded, setIsExpanded] = useState(false);
            
            // --- CÁLCULOS ---
            const totalPhysical = (parseFloat(item.bar1) || 0) + (parseFloat(item.bar2) || 0) + (parseFloat(item.bodega) || 0) + (parseFloat(item.barroluco) || 0);
            
            const start = parseFloat(item.start) || 0;
            const purchases = parseFloat(item.purchases) || 0;
            const sales = parseFloat(item.sales) || 0;
            
            // Venta Sistema = Ini + Compras - Fisico
            const systemConsumption = start + purchases - totalPhysical;

            // Diferencia = Ventas Registradas (Sales) - Venta Sistema
            const diff = sales - systemConsumption;

            const hasPhysicalData = item.bar1 || item.bar2 || item.bodega || item.barroluco;
            
            // Colores
            let statusColor = "bg-gray-800 border-gray-700"; 
            let badgeClass = "text-gray-400 bg-gray-900 border border-gray-700";
            
            if (hasPhysicalData) {
                if (diff < -0.1) { // Pérdida (Rojo)
                    statusColor = "bg-gray-800 border-red-900/50 shadow-[inset_4px_0_0_0_#ef4444]";
                    badgeClass = "text-red-400 bg-red-950/30 border border-red-900/50";
                } else if (diff > 0.1) { // Ganancia (Azul)
                    statusColor = "bg-gray-800 border-blue-900/50 shadow-[inset_4px_0_0_0_#3b82f6]";
                    badgeClass = "text-blue-400 bg-blue-950/30 border border-blue-900/50";
                } else { // Perfecto (Verde)
                    statusColor = "bg-gray-800 border-emerald-900/50 shadow-[inset_4px_0_0_0_#10b981]";
                    badgeClass = "text-emerald-400 bg-emerald-950/30 border border-emerald-900/50";
                }
            }

            return (
                <div className={`rounded-xl border shadow-lg transition-all duration-300 overflow-hidden ${statusColor} mb-3`}>
                    <div className="p-4 flex justify-between items-center cursor-pointer hover:bg-white/5 transition-colors" onClick={() => setIsExpanded(!isExpanded)}>
                        <div className="flex-1">
                            <div className="flex items-center gap-2">
                                <span className="font-bold text-gray-200 text-base">{item.name}</span>
                                {hasPhysicalData ? (
                                    <span className={`text-xs font-mono font-bold px-2 py-0.5 rounded-md ${badgeClass}`}>
                                        {diff > 0 ? "+" : ""}{diff.toFixed(1)}
                                    </span>
                                ) : null}
                            </div>
                            <div className="text-xs text-gray-500 mt-1 flex gap-3 font-mono">
                                <span>Consumo Calc: <b className="text-gray-300">{hasPhysicalData ? systemConsumption.toFixed(1) : "-"}</b></span>
                                <span className="text-gray-600">|</span>
                                <span>Venta Reg: <b className="text-gray-300">{sales.toFixed(1)}</b></span>
                            </div>
                        </div>
                        <div>{isExpanded ? <Icons.ChevronUp className="text-gray-500" /> : <Icons.ChevronDown className="text-gray-600" />}</div>
                    </div>

                    {isExpanded && (
                        <div className="p-4 border-t border-gray-700/50 bg-black/20 space-y-4 animate-in">
                            <div className="bg-gray-900/50 p-3 rounded-lg border border-gray-700/50">
                                <div className="flex items-center gap-2 mb-3 text-indigo-400 font-bold text-[10px] uppercase tracking-wider">
                                    <Icons.MapPin size={12} /> 1. Conteo Físico (Restar al sistema)
                                </div>
                                <div className="grid grid-cols-4 gap-2">
                                    <InputField label="Bar 1" value={item.bar1} onChange={(v) => onUpdate(item.id, 'bar1', v)} colorClass="border-gray-700 focus:border-indigo-500" />
                                    <InputField label="Bar 2" value={item.bar2} onChange={(v) => onUpdate(item.id, 'bar2', v)} colorClass="border-gray-700 focus:border-indigo-500" />
                                    <InputField label="Bodega" value={item.bodega} onChange={(v) => onUpdate(item.id, 'bodega', v)} colorClass="border-gray-700 focus:border-indigo-500" />
                                    <InputField label="B.Luco" value={item.barroluco} onChange={(v) => onUpdate(item.id, 'barroluco', v)} colorClass="border-gray-700 focus:border-indigo-500" />
                                </div>
                                <div className="text-right mt-2 text-xs font-bold text-gray-400">Total Físico: {totalPhysical}</div>
                            </div>

                            <div className="bg-amber-900/10 p-3 rounded-lg border border-amber-900/20">
                                <div className="flex items-center gap-2 mb-3 text-amber-500 font-bold text-[10px] uppercase tracking-wider">
                                    <Icons.Calculator size={12} /> 2. Cálculo de Consumo vs Ventas
                                </div>
                                <div className="grid grid-cols-2 gap-3 mb-3">
                                    <InputField label="Inv. Inicial" value={item.start} onChange={(v) => onUpdate(item.id, 'start', v)} colorClass="border-gray-600" />
                                    <InputField label="Compras (+)" value={item.purchases} onChange={(v) => onUpdate(item.id, 'purchases', v)} icon={Icons.ShoppingCart} colorClass="border-emerald-900/50 focus:border-emerald-500 text-emerald-300" />
                                </div>
                                <div className="grid grid-cols-1 gap-3">
                                    <InputField label="Ventas Totales ($)" value={item.sales} onChange={(v) => onUpdate(item.id, 'sales', v)} icon={Icons.DollarSign} colorClass="border-blue-900/50 focus:border-blue-500 text-blue-300" />
                                </div>
                                <div className="text-right mt-3 text-xs text-gray-400 font-mono space-y-1">
                                    <div className="text-amber-500/80">Venta Sistema = {start} + {purchases || 0} - {totalPhysical} = <b>{systemConsumption}</b></div>
                                    <div className="text-blue-400/80">Venta Registrada = <b>{sales}</b></div>
                                    <div className={`font-bold ${diff < 0 ? 'text-red-400' : 'text-emerald-400'}`}>
                                        Diferencia = {diff.toFixed(2)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [data, setData] = useState(() => {
                try {
                    const saved = localStorage.getItem('bar-master-inventory-v3-sales'); 
                    if (saved) return JSON.parse(saved);
                } catch (e) { }
                return INITIAL_DATA;
            });
            const [searchTerm, setSearchTerm] = useState("");
            const [openCategories, setOpenCategories] = useState({
                "Licores Premium (Tequila/Whisky)": true,
                "Wells (Licores de la Casa)": false,
                "Seltzer & Energy": false,
                "Cervezas": false,
                "Vinos": false
            });
            const [notification, setNotification] = useState(null);

            useEffect(() => {
                localStorage.setItem('bar-master-inventory-v3-sales', JSON.stringify(data));
            }, [data]);

            const handleReset = () => {
                if (window.confirm("¿Seguro que quieres BORRAR TODO?")) {
                    setData(INITIAL_DATA);
                    localStorage.removeItem('bar-master-inventory-v3-sales');
                    showNotification("Inventario reiniciado.");
                }
            };

            const updateItem = (itemId, field, value) => {
                setData(prev => prev.map(cat => ({
                    ...cat,
                    items: cat.items.map(item => item.id === itemId ? { ...item, [field]: value } : item)
                })));
            };

            const toggleCategory = (catName) => {
                setOpenCategories(prev => ({...prev, [catName]: !prev[catName]}));
            };

            // --- FUNCIÓN PARA DESCARGAR EXCEL (CSV) ---
            const downloadReport = () => {
                let csvContent = "PRODUCTO,FISICO TOTAL,INICIAL,COMPRAS,VENTA SISTEMA (Consumo),VENTAS TOTALES,DIFERENCIA\n";
                let count = 0;

                data.forEach(cat => {
                    cat.items.forEach(item => {
                        const hasData = item.bar1 || item.bar2 || item.bodega || item.barroluco || item.purchases || item.sales;
                        if (hasData) {
                            count++;
                            const totalPhys = (parseFloat(item.bar1)||0) + (parseFloat(item.bar2)||0) + (parseFloat(item.bodega)||0) + (parseFloat(item.barroluco)||0);
                            const start = parseFloat(item.start)||0;
                            const purchases = parseFloat(item.purchases)||0;
                            const sales = parseFloat(item.sales)||0;
                            
                            const systemConsumption = start + purchases - totalPhys;
                            const diff = sales - systemConsumption;

                            // Formato CSV (comillas para evitar errores con comas en nombres)
                            const row = [
                                `"${item.name}"`,
                                totalPhys,
                                start,
                                purchases,
                                systemConsumption,
                                sales,
                                diff.toFixed(2)
                            ].join(",");
                            
                            csvContent += row + "\n";
                        }
                    });
                });

                if (count === 0) {
                    showNotification("Ingresa datos primero para descargar.");
                    return;
                }

                // Crear Blob con BOM para que Excel lea acentos correctamente
                const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.setAttribute("download", `Reporte_Bar_${new Date().toLocaleDateString().replace(/\//g, '-')}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification("¡Reporte descargado!");
            };

            const showNotification = (msg) => {
                setNotification(msg);
                setTimeout(() => setNotification(null), 3000);
            };

            const filteredData = useMemo(() => {
                if (!searchTerm) return data;
                return data.map(cat => ({
                    ...cat,
                    items: cat.items.filter(item => item.name.toLowerCase().includes(searchTerm.toLowerCase()))
                })).filter(cat => cat.items.length > 0);
            }, [data, searchTerm]);

            const getIcon = (catName) => {
                if (catName.includes("Licores")) return Icons.GlassWater;
                if (catName.includes("Wells")) return Icons.Package;
                if (catName.includes("Cervezas")) return Icons.Beer;
                if (catName.includes("Vinos")) return Icons.Wine;
                return Icons.RefreshCw;
            };

            return (
                <div className="min-h-screen pb-20">
                    <Header onReset={handleReset} onDownload={downloadReport} />
                    
                    <div className="bg-gray-900 p-4 border-b border-gray-800 sticky top-[72px] z-20">
                        <div className="max-w-5xl mx-auto relative">
                            <Icons.Search className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500" size={20} />
                            <input type="text" placeholder="Buscar producto..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full bg-gray-800 rounded-xl pl-10 pr-4 py-3 text-gray-200 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-500/50 transition-all placeholder:text-gray-600" />
                        </div>
                    </div>

                    <main className="max-w-5xl mx-auto p-4 space-y-4">
                        {filteredData.length === 0 && <div className="text-center py-20 text-gray-600"><p>No se encontraron productos.</p></div>}
                        
                        {filteredData.map((cat) => (
                            <div key={cat.category} className="mb-6">
                                {!searchTerm && <CategoryHeader title={cat.category} icon={getIcon(cat.category)} isOpen={openCategories[cat.category]} toggle={() => toggleCategory(cat.category)} />}
                                {(openCategories[cat.category] || searchTerm) && (
                                    <div className="grid gap-2 sm:grid-cols-1 lg:grid-cols-2">
                                        {cat.items.map(item => <InventoryRow key={item.id} item={item} onUpdate={updateItem} />)}
                                    </div>
                                )}
                            </div>
                        ))}
                    </main>

                    {notification && (
                        <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl border border-gray-700 flex items-center gap-3 animate-in z-50 whitespace-nowrap">
                            <Icons.CheckCircle size={18} className="text-emerald-400" />
                            <span className="font-medium text-sm">{notification}</span>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>
</html>